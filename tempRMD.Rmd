---
title: "The intelligent beer: Machine Lite"
author: "Unofficial Intelligence: Carson Drake, David Josephs, Samantha Sprague"
date: "October 15, 2018"
output: 
  ioslides_presentation:
    widescreen: true
    smaller: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

```

```{r libraries, include=FALSE}
knitr::opts_chunk$set(
	fig.align = "center",
	out.width = "80%",
	echo = FALSE,
	error=FALSE, 
	message=FALSE, 
	warning=FALSE);
library(dplyr)
library(ggplot2)
library(readr)
library(stringr)
library(highcharter)
library(ggthemes)
library(knitr);
```

# Introduction

## QQTD: Given the datasets Beer and Brews, we want to know:
###-Where our headquaters should be? 
###-What style of beer would appeal to the widest audience?
###-If we wanted to have a high ABV, what is the ideal IBU? 

## The Data
```{r merge}
# Reading in CSV data sets
rawBeer <- read.csv(file = "data/raw/Beers.csv",header=TRUE, sep=",",stringsAsFactors=FALSE)
rawBrew <- read.csv(file= "data/raw/Breweries.csv", header=TRUE, sep=",", stringsAsFactors=FALSE)


# Next we rename  the brewery IDs, and merge the data:
Beer1 <- rawBeer %>% rename(Brewery_ID=Brewery_id)
Brew1 <- rawBrew %>% rename(Brewery_ID=Brew_ID)
Beer1 <- Beer1 %>% select(Name,Beer_ID,ABV,IBU,Style,Ounces,Brewery_ID)
BeerBrew <- merge(Beer1,Brew1, by='Brewery_ID')

# Next we reorder the columns and give ourselves human readable names
BeerBrew <- BeerBrew %>% rename(BeerName = Name.x) %>% rename(BreweryName = Name.y)
BeerBrew <- BeerBrew %>% select(BeerName,Beer_ID,ABV,IBU,Style,Ounces,BreweryName,Brewery_ID,City,State)

# Here we do a head of the new dataset BeerBrew
kable(head(BeerBrew,6))
```

####<font size="1">Caption: Here is a quick glance at the head of our merged dataset. You can see we created easy to read captions and merged the two raw datasets with our renames field "Brewery_ID".</font>

####<font size="5">Here are the first 6 rows of our merged data set.</font>

## The Data (continued)
```{r}
kable(tail(BeerBrew,6))
```

####<font size="1">Caption: Here is a quick glance at the tail of our merged dataset. You can see we created easy to read captions and merged the two raw datasets with our renames field "Brewery_ID".</font>

####<font size="5">Here are the last 6 rows of our merged data set.</font>


## The Data: Median Values and Breweries by State
```{r}
#Creating a dataset with the median ABVs and IBUs per state, and counting the number of breweries
StateSummary <- as.data.frame(BeerBrew %>% group_by(State) %>% summarise(medianABV = median(ABV, na.rm=TRUE),medianIBU = median(IBU, na.rm=TRUE),NumBreweries = n_distinct(Brewery_ID)))

#Creating a knitr table for the presentation
kable(head(StateSummary,6))
```

#### <font size="5">In order to make the dataset more friendly for analysis, we created a new dataset from our merged dataset that would look at the median ABVs and IBUs, along with the number of breweries for each state.</font>


## Missing Values
#### The next logical step in analyzing the dataset was to find missing values. 
```{r NA_count}
# This code is used to identify missing values
na_count <- data.frame(sapply(BeerBrew, function(y) sum(length(which(is.na(y))))))
na_count<- na_count%>%rename(na_count=sapply.BeerBrew..function.y..sum.length.which.is.na.y.....)
na_count
```
########<font size="4">There are 62 missing data points for ABV, and 1005 missing data points for IBU.</font>

# Graphics: Number of Breweries

## 
```{r map_of_numbrew}
#Pulling in the data from the highcharter. 
mapdata <- get_data_from_map(download_map_data("countries/us/us-all"))

StateSummary$State <- str_trim(StateSummary$State,side="both")
StateSummary <- StateSummary %>% mutate(`hc-a2`= State);
mapdata <- get_data_from_map(download_map_data("countries/us/us-all"))


#Below is an interactive state map that allows you to toggle over each state and showcase the number of breweries within that particular state. It also includes a heatmap to represent the number by color. The darker the state, the more breweries it contains! 
# Map of numbers 


hcmap("countries/us/us-all", data = StateSummary, value = "NumBreweries",
	  joinBy = "hc-a2", name = "State Summary | # of Breweries",
	  dataLabels = list(enabled = TRUE, format = '{point.name}'),
	  borderColor = "#FAFAFA", borderWidth = 0.1,
	  tooltip = list(valueDecimals = 1,valueSuffix = " # of Breweries")) %>%
	hc_colorAxis(minColor = "#FFFFFF", maxColor = "#7F152E") %>%
	hc_mapNavigation(enabled = TRUE) %>%
	hc_title(text = "<b>Number of Breweries by State</b>",
			 margin = 20, align = "center", 
			 style = list(color = "#000000", 
			 			 useHTML = TRUE))
```

####<font size="2">We can see that the Colorado has the darkest coloring on the graph which alludes to the highest number of breweries! Colorado contains 47 breweries. California, Oregon, Texas and Washington fall behind with 39, 29, 28, and 23 breweries.</font>


# Graphics: Analysis on ABV

## 
```{r map of ABV}
map3 <-hcmap("countries/us/us-all", data = StateSummary, value = "medianABV",
	  joinBy = "hc-a2", name = "State Summary | Median ABV",
	  dataLabels = list(enabled = TRUE, format = '{point.name}'),
	  borderColor = "#FAFAFA", borderWidth = 0.1,
	  tooltip = list(valueDecimals = 5,valueSuffix = " ABV")) %>%
	hc_colorAxis(minColor = "#FFFFFF", maxColor = "#34675C") %>%
	hc_mapNavigation(enabled = TRUE) %>%
	hc_title(text = "<b>Median ABV by State</b>",
			 margin = 20, align = "center", 
			 style = list(color = "#000000", 
			 			 useHTML = TRUE))
htmltools::tagList(map3)
```

# 
```{r medianABVplot}
g <-ggplot(StateSummary, aes(x=reorder(State,-medianABV),y=medianABV, fill=medianABV)) +  geom_bar(stat="identity") 
 g2 <-g
 g3<-g2+coord_flip(ylim=c(.04,.0650))
 g4<-g3+theme(legend.position='none')
 g5<-g4+scale_fill_gradient2(midpoint=median(StateSummary$medianABV),low='red', mid='snow3', high='black', space='Lab')+theme_classic()+labs(x="State", y="ABV", legend="ABV")+ggtitle("Median ABV by state") + theme(plot.title = element_text(hjust = 0.5)) 
g5
```

## Maximum ABV
```{r maximumIndividualABV}
# This finds the state which has the most alcoholic beer, the name of the beer, the city it is produced in, and the actual ABV of the beer
MaxABV <- BeerBrew %>% select(State, BeerName, City, ABV) %>% filter(!is.na(ABV)) %>% arrange(desc(ABV)) %>% slice(1)
MaxABV
```

####<font size="3">Colorado has the most alcoholic beer of any state!  Lee Hill Series Vol. 5, a Belgian Style Quadrupel Ale produced in Boulder,CO  has an ABV of 12.8%</font>



# Graphics: Analysis on IBU

## 
```{r ibumap}
map2<-hcmap("countries/us/us-all", data = StateSummary, value = "medianIBU",
	  joinBy = "hc-a2", name = "State Summary | Median IBU",
	  dataLabels = list(enabled = TRUE, format = '{point.name}'),
	  borderColor = "#FAFAFA", borderWidth = 0.1,
	  tooltip = list(valueDecimals = 5,valueSuffix = " IBU")) %>%
	hc_colorAxis(minColor = "#FFFFFF", maxColor = "#4C3F54") %>%
	hc_mapNavigation(enabled = TRUE) %>%
	hc_title(text = "<b>Median IBU by State</b>",
			 margin = 20, align = "center", 
			 style = list(color = "#000000", 
			 			 useHTML = TRUE))
htmltools::tagList(map2)
```

## Median IBU
```{r medianIBUplot}
p<-ggplot(StateSummary, aes(x=reorder(State,-medianIBU),y=medianIBU, fill=medianIBU)) +  geom_bar(stat="identity") 
 p2 <-p
 p3<-p2+coord_flip(ylim=c(18,70))
 p4<-p3+theme(legend.position='none')
 p5<-p4+scale_fill_gradient2(midpoint=median(StateSummary$medianIBU,na.rm=TRUE),low='red', mid='snow3', high='black', space='Lab')+theme_classic()+labs(x="State", y="IBU", legend="IBU")+ggtitle("Median IBU by state") +
  theme(plot.title = element_text(hjust = 0.5)) 
p5
```
 

## Maximum IBU 

```{r maximumIndividualIBU}
#This finds the state which has the most bitter beer, the name of the beer, the city it is produced in, and the actual IBU of the beer
MaxIBU <- BeerBrew %>% select(State, BeerName,City,  IBU) %>% filter(!is.na(IBU)) %>% arrange(desc(IBU)) %>% slice(1)
MaxIBU
```
####<font size="3">Oregon has the bitterest beer of any state! Bitter Bitch Imperial IPA, produced in Astoria, has an IBU of 138!</font>



# Graphics: Analysis on ABV vs IBU

## 
```{r scatterplotgg}
q<-ggplot(data=BeerBrew, aes(x=ABV,y=IBU))+geom_point()+geom_smooth(method="glm",aes(color="Linear"))+scale_color_manual(name="Fits",breaks=c("Linear"),values=c("blue"))+theme_classic()+ggtitle("Bitterness vs ABV") +theme(plot.title = element_text(hjust = 0.5))+labs(x="ABV", y="IBU")+xlim(.027,0.15)
q
```
####<font size="3">There needs to be a comment here about this graph.</font>

## Another view: ABV vs IBU for All Beers

```{r}
hchart(BeerBrew, "scatter", hcaes(x=BeerBrew$ABV,  y=BeerBrew$IBU, group =BeerBrew$Style)) %>%
	hc_xAxis(title = list(text = "ABV for All Beers")) %>%
	hc_yAxis(title = list(text = "IBU for All Beers"))
```

## More Style Analysis
```{r}
BeerBrew %>% count(Style) %>% arrange(desc(n))%>% as.data.frame() -> styledf

hchart(styledf, "treemap", hcaes(x = styledf$Style, value = n, color = n))
```

####<font size="3">You can see here that the market is saturated with American IPA's.</font>

# Numbers: Summary Statistics

## Summary Statistics for ABV
```{r summary}
summary(BeerBrew$ABV, na.rm=TRUE)
```
####<font size="3">You can see that the median ABV for all beers is roughly 0.056 and the mean ABV is 0.5977. It is also worth noting that there at 62 beers who do not have a recorded ABV. Those beers were not considered in the analysis for ABV.</font>



## Summary Statistics for IBU
```{r}
summary(BeerBrew$IBU, na.rm=TRUE)
```
####<font size="3">You can see that the median IBU for all beers is roughly 35 and the mean IBU is 42.71. It is also worth noting that there at 1005 beers who do not have a recorded IBU. Those beers were not considered in the analysis for IBU.</font>

# Conclusions

## Headquarter Recommendation

## Style of Beer Recommendation


# Thank you

## Questions?

####<font size="3">Insert Funny Meme Here.</font>
