---
title: "Untitled"
author: "David Josephs"
date: "October 14, 2018"
output:
  slidy_presentation: default

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,results = 'HTML')

```
```{r libraries}
library(dplyr)
library(ggplot2)
library(readr)
library(stringr)
library(highcharter)
library(ggthemes)
```

# The Data


```{r merge}
rawBeer <- read.csv(file = "data/raw/Beers.csv",header=TRUE, sep=",",stringsAsFactors=FALSE)
rawBrew <- read.csv(file= "data/raw/Breweries.csv", header=TRUE, sep=",", stringsAsFactors=FALSE)

# Next we rename  the brewery IDs, and merge the data:

Beer1 <- rawBeer %>% rename(Brewery_ID=Brewery_id)
Brew1 <- rawBrew %>% rename(Brewery_ID=Brew_ID)
Beer1 <- Beer1 %>% select(Name,Beer_ID,ABV,IBU,Style,Ounces,Brewery_ID)
BeerBrew <- merge(Beer1,Brew1, by='Brewery_ID')

# Next we reorder the columns and give ourselves human readable names


BeerBrew <- BeerBrew %>% rename(BeerName = Name.x) %>% rename(BreweryName = Name.y)
BeerBrew <- BeerBrew %>% select(BeerName,Beer_ID,ABV,IBU,Style,Ounces,BreweryName,Brewery_ID,City,State)


head(BeerBrew)
tail(BeerBrew)

# we also need summaries 
StateSummary <- as.data.frame(BeerBrew %>% group_by(State) %>% summarise(medianABV = median(ABV, na.rm=TRUE),medianIBU = median(IBU, na.rm=TRUE),NumBreweries = n_distinct(Brewery_ID)))
```

# Missing Values


```{r NA count}
na_count <- data.frame(sapply(BeerBrew, function(y) sum(length(which(is.na(y))))))
na_count<- na_count%>%rename(na_count=sapply.BeerBrew..function.y..sum.length.which.is.na.y.....)
na_count
```
There are 62 missing data points for ABV, and 1005 missing data points for IBU.

# Map of numbers 


```{r map of numbrew}
StateSummary$State <- str_trim(StateSummary$State,side="both")
StateSummary2 <- StateSummary %>% mutate(`hc-a2`= State)
map1 <-hcmap("countries/us/us-all",
	  data = StateSummary2,
	  value = "NumBreweries",
      joinBy = "hc-a2",
	  name = "State Summary | NumBreweries",
      dataLabels = list(enabled = TRUE, format = '{point.name}'),
      borderColor = "#FAFAFA",
	  borderWidth = 0.1,
      tooltip = list(valueDecimals = 0,valueSuffix = " Breweries")
	  ) %>%
	hc_title(text = "This is a title with <i>margin</i> and <b>Strong or bold text</b>",
			 margin = 20, align = "left",
			 style = list(color = "#90ed7d", useHTML = TRUE)) %>%
	hc_colorAxis(minColor = "#FFFFFF", maxColor = "#FF0000") %>%
	hc_mapNavigation(enabled = TRUE)

htmltools::tagList(map1)

```


We can see that the Colorado has the darkest coloring on the graph which alludes to the highest number of breweries! Colorado contains 47 breweries. California, Oregon, Texas and Washington fall behind with 39, 29, 28, and 23 breweries.

# Map of IBU


```{r ibumap}
map2<-hcmap("countries/us/us-all", data = StateSummary, value = "medianIBU",
	  joinBy = "hc-a2", name = "State Summary | Median IBU",
	  dataLabels = list(enabled = TRUE, format = '{point.name}'),
	  borderColor = "#FAFAFA", borderWidth = 0.1,
	  tooltip = list(valueDecimals = 5,valueSuffix = " IBU")) %>%
	hc_colorAxis(minColor = "#FFFFFF", maxColor = "#4C3F54") %>%
	hc_mapNavigation(enabled = TRUE) %>%
	hc_title(text = "<b>Median IBU by State</b>",
			 margin = 20, align = "center", 
			 style = list(color = "#000000", 
			 			 useHTML = TRUE))
htmltools::tagList(map2)
```

# Median IBU


```{r medianIBUplot}
p<-ggplot(StateSummary, aes(x=reorder(State,-medianIBU),y=medianIBU, fill=medianIBU)) +  geom_bar(stat="identity") 
 p2 <-p
 p3<-p2+coord_flip(ylim=c(18,70))
 p4<-p3+theme(legend.position='none')
 p5<-p4+scale_fill_gradient2(midpoint=median(StateSummary$medianIBU,na.rm=TRUE),low='red', mid='snow3', high='black', space='Lab')+theme_classic()+labs(x="State", y="IBU", legend="IBU")+ggtitle("Median IBU by state") +
  theme(plot.title = element_text(hjust = 0.5)) 
p5
 ```
```{r maximumIndividualIBU}
#This finds the state which has the most bitter beer, the name of the beer, the city it is produced in, and the actual IBU of the beer
MaxIBU <- BeerBrew %>% select(State, BeerName,City,  IBU) %>% filter(!is.na(IBU)) %>% arrange(desc(IBU)) %>% slice(1)
MaxIBU
```

Oregon has the bitterest beer of any state! Bitter Bitch Imperial IPA, produced in Astoria, has an IBU of 138!
# Map of ABV


```{r map of ABV}
map3 <-hcmap("countries/us/us-all", data = StateSummary, value = "medianABV",
	  joinBy = "hc-a2", name = "State Summary | Median ABV",
	  dataLabels = list(enabled = TRUE, format = '{point.name}'),
	  borderColor = "#FAFAFA", borderWidth = 0.1,
	  tooltip = list(valueDecimals = 5,valueSuffix = " ABV")) %>%
	hc_colorAxis(minColor = "#FFFFFF", maxColor = "#34675C") %>%
	hc_mapNavigation(enabled = TRUE) %>%
	hc_title(text = "<b>Median ABV by State</b>",
			 margin = 20, align = "center", 
			 style = list(color = "#000000", 
			 			 useHTML = TRUE))
htmltools::tagList(map3)
```



# median ABV


```{r medianABVplot}
g <-ggplot(StateSummary, aes(x=reorder(State,-medianABV),y=medianABV, fill=medianABV)) +  geom_bar(stat="identity") 
 g2 <-g
 g3<-g2+coord_flip(ylim=c(.04,.0650))
 g4<-g3+theme(legend.position='none')
 g5<-g4+scale_fill_gradient2(midpoint=median(StateSummary$medianABV),low='red', mid='snow3', high='black', space='Lab')+theme_classic()+labs(x="State", y="ABV", legend="ABV")+ggtitle("Median ABV by state") + theme(plot.title = element_text(hjust = 0.5)) 
g5
 ```

```{r maximumIndividualABV}
# This finds the state which has the most alcoholic beer, the name of the beer, the city it is produced in, and the actual ABV of the beer
MaxABV <- BeerBrew %>% select(State, BeerName, City, ABV) %>% filter(!is.na(ABV)) %>% arrange(desc(ABV)) %>% slice(1)
MaxABV
```


Colorado has the most alcoholic beer of any state!  Lee Hill Series Vol. 5, a Belgian Style Quadrupel Ale produced in Boulder,CO  has an ABV of 12.8%
# ABV vs IBU


```{r scatterplotgg}
q<-ggplot(data=BeerBrew, aes(x=ABV,y=IBU))+geom_point()+geom_smooth(method="glm",aes(color="Linear"))+scale_color_manual(name="Fits",breaks=c("Linear"),values=c("blue"))+theme_classic()+ggtitle("Bitterness vs ABV") +theme(plot.title = element_text(hjust = 0.5))+labs(x="ABV", y="IBU")+xlim(.027,0.15)
q
```

# More info on ABV


```{r summary}
summary(BeerBrew$ABV, na.rm=TRUE)
```


 
You can see that the median ABV for all beers is roughly 0.056 and the mean ABV is 0.5977. It is also worth noting that there at 62 beers who do not have a recorded ABV. Those beers were not considered in the analysis for ABV. 

